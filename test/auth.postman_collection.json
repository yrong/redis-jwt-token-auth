{
	"info": {
		"name": "auth",
		"_postman_id": "651dc08b-7e52-25a6-8ef1-2d6547fbff1b",
		"description": "",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "prepare",
			"item": [
				{
					"name": "add superadmin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"id": "1a36a392-560e-429f-be84-7a5de9bb90fb",
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\":\"superadmin\",\n  \"passwd\":\"superadmin\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/register",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "login with superadmin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var token = jsonData.token||jsonData.data.token;",
									"tests[\"token found\"] = token;",
									"if(token){",
									"  postman.setEnvironmentVariable(\"token\", token);  ",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\":\"superadmin\",\n  \"password\":\"superadmin\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/login",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "clean",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/hidden/clean",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"hidden",
								"clean"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "role&user",
			"item": [
				{
					"name": "add role viewer",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"add role success\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n      \"name\":\"viewer\",\n     \"allows\":[{\"resources\":\"*\",\"permissions\":[\"READ\"]}],\n     \"additional\":{\"menus\":[\"menu1\",\"menu3\"]}\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/role?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"role"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "add role contributor",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"add role success\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n      \"name\":\"contributor\",\n     \"allows\":[{\"resources\":\"own\",\"permissions\":[\"UPDATE\",\"DELETE\"]},{\"resources\":\"*\",\"permissions\":[\"CREATE\",\"READ\"]}],\n     \"additional\":{\"menus\":[\"menu1\",\"menu3\"]}\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/role?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"role"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "add role superAdmin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"add role success\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n      \"name\":\"superAdmin\",\n     \"allows\":[{\"resources\":\"*\",\"permissions\":\"*\"}],\n     \"additional\":{\"menus\":[\"menu2\",\"menu3\"]}\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/role",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"role"
							]
						}
					},
					"response": []
				},
				{
					"name": "batch add roles",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"add role success\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "[\n  {\n      \"name\":\"viewer\",\n     \"allows\":[{\"resources\":\"*\",\"permissions\":[\"READ\"]}],\n     \"additional\":{\"menus\":[\"menu1\",\"menu3\"]}\n  },\n  {\n      \"name\":\"contributor\",\n     \"allows\":[{\"resources\":\"own\",\"permissions\":[\"UPDATE\",\"DELETE\"]},{\"resources\":\"*\",\"permissions\":[\"CREATE\",\"READ\"]}],\n     \"additional\":{\"menus\":[\"menu1\",\"menu3\"]}\n  },\n  {\n      \"name\":\"superAdmin\",\n     \"allows\":[{\"resources\":\"*\",\"permissions\":\"*\"}],\n     \"additional\":{\"menus\":[\"menu2\",\"menu3\"]}\n  }\n]"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/roles?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"roles"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "add external role",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"add role success\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n      \"name\":\"external\",\n     \"allows\":[{\"resources\":\"*\",\"permissions\":\"*\"}],\n     \"external\":true\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/role",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"role"
							]
						}
					},
					"response": []
				},
				{
					"name": "query role",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var role = jsonData.data||jsonData",
									"tests[\"at least one permission found\"] = role.allows.length >=1"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/role/contributor?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"role",
								"contributor"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "query roles",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "55ea85a4-080d-4406-a680-3bcc1ad15df9",
								"type": "text/javascript",
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var roles = jsonData.data||jsonData;",
									"tests[\"at least one role found\"] = roles.count >=1"
								]
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/role",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"role"
							]
						}
					},
					"response": []
				},
				{
					"name": "query internal roles paginated",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "c9aaf717-5ae6-438f-8123-84bd60796d17",
								"type": "text/javascript",
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var roles = jsonData.data||jsonData;",
									"tests[\"at least one role found\"] = roles.count >=1"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/role?external=false&page=1&per_page=2",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"role"
							],
							"query": [
								{
									"key": "external",
									"value": "false",
									"equals": true
								},
								{
									"key": "page",
									"value": "1",
									"equals": true
								},
								{
									"key": "per_page",
									"value": "2",
									"equals": true
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "add demo user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"add user success\"] = responseCode.code == 200",
									"var jsonData = JSON.parse(responseBody);",
									"jsonData = jsonData.data||jsonData",
									"var userid = jsonData.uuid",
									"tests[\"userid found\"] = userid;",
									"if(userid){",
									"  postman.setEnvironmentVariable(\"auth_user_id\", userid);  ",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\":\"{{auth_user}}\",\n  \"passwd\":\"{{auth_passwd}}\",\n  \"email\":\"{{auth_user_email}}\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/register",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "bind role to demo user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"bind role to user success\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n      \"roles\":[\"superAdmin\"]\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/assocRole/{{auth_user_id}}?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"assocRole",
								"{{auth_user_id}}"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "login with demo user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var token = jsonData.token||jsonData.data.token;",
									"tests[\"token found\"] = token;",
									"if(token){",
									"   postman.setEnvironmentVariable(\"token\", token); ",
									"}",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\":\"{{auth_user}}\",\n  \"password\":\"{{auth_passwd}}\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/login",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "delete role already used failed",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"delete role already used failed\"] = responseCode.code != 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/role/superAdmin?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"role",
								"superAdmin"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "query User By userid",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"user found\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/userinfo/{{auth_user_id}}?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"userinfo",
								"{{auth_user_id}}"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "modify user passwd",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"passwd modified\"] = responseCode.code == 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"token\":\"{{token}}\",\n  \"oldpwd\":\"{{auth_passwd}}\",\n  \"newpwd\":\"{{auth_passwd}}\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/changepwd/{{auth_user_id}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"changepwd",
								"{{auth_user_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "modify user info",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"user modified\"] = responseCode.code == 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n   \"token\":\"{{token}}\",\n  \"avatar\":\"/upload/avatar/ca92d560-05a6-11e7-98ba-e1d08df9a25f\",\n  \"per_page\":90\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/userinfo/{{auth_user_id}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"userinfo",
								"{{auth_user_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "modify demo user department",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"user modified\"] = responseCode.code == 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"department\":\"{{department_2_id}}\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/userinfo/{{auth_user_id}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"userinfo",
								"{{auth_user_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "add test user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"add user success\"] = responseCode.code == 200",
									"var jsonData = JSON.parse(responseBody);",
									"jsonData = jsonData.data||jsonData",
									"var userid = jsonData.uuid",
									"tests[\"userid found\"] = userid;",
									"if(userid){",
									"  postman.setEnvironmentVariable(\"test_user_id\", userid);  ",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\":\"test\",\n  \"passwd\":\"test\",\n  \"email\":\"test@email.com\",\n  \"external\":true\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/register",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "del test user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"user deleted\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"uuids\":[\"{{test_user_id}}\"]\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/unregister",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"unregister"
							]
						}
					},
					"response": []
				},
				{
					"name": "add test user as external",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"add user success\"] = responseCode.code == 200",
									"var jsonData = JSON.parse(responseBody);",
									"jsonData = jsonData.data||jsonData",
									"var userid = jsonData.uuid",
									"tests[\"userid found\"] = userid;",
									"if(userid){",
									"  postman.setEnvironmentVariable(\"test_user_id\", userid);  ",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\":\"test\",\n  \"passwd\":\"test\",\n  \"email\":\"test@email.com\",\n  \"external\":true\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/register",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "modify test user info",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"user modified\"] = responseCode.code == 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"avatar\":\"/upload/avatar/ca92d560-05a6-11e7-98ba-e1d08df9a25f\",\n  \"per_page\":90\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/userinfo/{{test_user_id}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"userinfo",
								"{{test_user_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "bind to internal user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"user modified\"] = responseCode.code == 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n   \"token\":\"{{token}}\",\n  \"internalId\":\"{{auth_user_id}}\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/userinfo/{{test_user_id}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"userinfo",
								"{{test_user_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "bind to role",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"bind role to user success\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n      \"roles\":[\"contributor\"]\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/assocRole/{{test_user_id}}?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"assocRole",
								"{{test_user_id}}"
							],
							"query": [
								{
									"key": "token",
									"value": "{{token}}",
									"equals": true
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "modify test user department",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"user modified\"] = responseCode.code == 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n   \"token\":\"{{token}}\",\n  \"department\":\"{{department_3_id}}\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/userinfo/{{test_user_id}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"userinfo",
								"{{test_user_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "query all user",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "b240473e-1993-46de-ab5b-cd750f1a37ef",
								"type": "text/javascript",
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var users = jsonData.data||jsonData",
									"tests[\"at least one user found\"] = users.count >=1"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/userinfo",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"userinfo"
							]
						}
					},
					"response": []
				},
				{
					"name": "query external user paginated",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "b240473e-1993-46de-ab5b-cd750f1a37ef",
								"type": "text/javascript",
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var users = jsonData.data||jsonData",
									"tests[\"at least one user found\"] = users.count >=1"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "token",
								"value": "{{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/userinfo?external=true&page=1&per_page=2",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"userinfo"
							],
							"query": [
								{
									"key": "external",
									"value": "true",
									"equals": true
								},
								{
									"key": "page",
									"value": "1",
									"equals": true
								},
								{
									"key": "per_page",
									"value": "2",
									"equals": true
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "token",
			"item": [
				{
					"name": "login with user not exist",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"login failed\"] = responseCode.code != 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\":\"wronguser\",\n  \"password\":\"test\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/login",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "login with wrong passwd",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"login failed\"] = responseCode.code != 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\":\"{{auth_user}}\",\n  \"password\":\"wrongpasswd\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/login",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "check valid token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"token valid\"] = responseCode.code == 200"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"token\":\"{{token}}\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/check",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"check"
							]
						}
					},
					"response": []
				},
				{
					"name": "check invalid token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"token invalid\"] = responseCode.code != 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"token\":\"hello\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/check",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"check"
							]
						}
					},
					"response": []
				},
				{
					"name": "query active tokens",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody)",
									"var tokens = jsonData.data||jsonData",
									"tests[\"token found\"] = tokens.length >0",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/active_users?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"active_users"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "ldap",
			"item": [
				{
					"name": "login-ldap",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var token = jsonData.data&&jsonData.data.token||jsonData.token",
									"tests[\"token found\"] = token;",
									"if(token){",
									"    postman.setEnvironmentVariable(\"token\", token);",
									"}",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\":\"{{auth_ldap_user}}\",\n  \"password\":\"{{auth_ldap_passwd}}\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/login-ldap",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"login-ldap"
							]
						}
					},
					"response": []
				},
				{
					"name": "assoc with ldap",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"assoc with ldap success\"] = responseCode.code == 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n   \"token\":\"{{token}}\",\n   \"ldapId\":\"cn=test test,ou=users,dc=test,dc=com\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/assoc/{{auth_user_id}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"assoc",
								"{{auth_user_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "unassoc",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"tests[\"unassoc with ldap success\"] = responseCode.code == 200",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n   \"token\":\"{{token}}\"\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/unassoc/{{auth_user_id}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"unassoc",
								"{{auth_user_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "search ldap user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var ldap_users = jsonData.data||jsonData",
									"tests['ldap users found']=ldap_users.length>0"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/enterprise/users?token={{token}}&page=1&per_page=5",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"enterprise",
								"users"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								},
								{
									"equals": true,
									"key": "page",
									"value": "1"
								},
								{
									"equals": true,
									"key": "per_page",
									"value": "5"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "search ldap user advanced",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var ldap_users = jsonData.data||jsonData",
									"tests['ldap users found']=ldap_users.length>0",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"base\":\"ou=users,dc=test,dc=com\",\n  \"options\":{\n    \"filter\": \"(objectclass=posixAccount)\"\n  }\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/ldapsearch?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"ldapsearch"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "search ldap department",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var ldap_users = jsonData.data||jsonData",
									"tests['ldap department found']=ldap_users.length>0"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"base\":\"dc=test,dc=com\",\n  \"options\":{\n    \"filter\": \"(objectclass=posixGroup)\",\n    \"paged\": {\n        \"pageSize\": 5,\n        \"page\":2\n      }\n  }\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/enterprise/departments?token={{token}}&page=1&per_page=5",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"enterprise",
								"departments"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								},
								{
									"equals": true,
									"key": "page",
									"value": "1"
								},
								{
									"equals": true,
									"key": "per_page",
									"value": "5"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "search ldap department advanced",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = JSON.parse(responseBody);",
									"var ldap_users = jsonData.data||jsonData",
									"tests['ldap department found']=ldap_users.length>0",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"base\":\"dc=test,dc=com\",\n  \"options\":{\n    \"filter\": \"(objectclass=posixGroup)\",\n    \"paged\": {\n        \"pageSize\": 5,\n        \"page\":2\n      }\n  }\n}"
						},
						"url": {
							"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/ldapsearch?token={{token}}",
							"protocol": "http",
							"host": [
								"{{auth_api_host}}"
							],
							"port": "{{auth_api_port}}",
							"path": [
								"auth",
								"ldapsearch"
							],
							"query": [
								{
									"equals": true,
									"key": "token",
									"value": "{{token}}"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "logout",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"",
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"token\":\"{{token}}\"\n}"
				},
				"url": {
					"raw": "http://{{auth_api_host}}:{{auth_api_port}}/auth/logout",
					"protocol": "http",
					"host": [
						"{{auth_api_host}}"
					],
					"port": "{{auth_api_port}}",
					"path": [
						"auth",
						"logout"
					]
				}
			},
			"response": []
		}
	]
}